services:

  #
  # Utilities
  #
  myspeed:
    image: germannewsmaker/myspeed:latest
    container_name: myspeed
    restart: unless-stopped
    networks:
      - mvr-hl
    volumes:
      - ${DATA_DIR:-/opt/apps}/myspeed:/myspeed/data
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.myspeed.entrypoints=web"
      - "traefik.http.routers.myspeed.rule=Host(`speedtest.mvr.io`)"
      - "traefik.http.services.myspeed.loadbalancer.server.port=5216"

  convertx: 
    image: ghcr.io/c4illin/convertx:latest
    container_name: convertx
    restart: unless-stopped
    volumes:
      - ${DATA_DIR:-/opt/apps}/convertx:/app/data
    environment:
      - ALLOW_UNAUTHENTICATED=true
      - HTTP_ALLOWED=true
    networks:
      - mvr-hl
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.convertx.entrypoints=web"
      - "traefik.http.routers.convertx.rule=Host(`convert.mvr.io`)"
      - "traefik.http.services.convertx.loadbalancer.server.port=3000"

  stirling-pdf:
    image: docker.stirlingpdf.com/stirlingtools/stirling-pdf:latest
    container_name: stirling-pdf
    restart: unless-stopped
    volumes:
      - ${DATA_DIR:-/opt/apps}/stirling-pdf/configs:/configs
      - ${DATA_DIR:-/opt/apps}/stirling-pdf/pipeline:/pipeline
      - /usr/share/tessdata # Required for extra OCR languages
      - /customFiles
      - /logs
    environment:
      - DOCKER_ENABLE_SECURITY=false
      - LANGS=en_GB
    networks:
      - mvr-hl
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.stirling-pdf.entrypoints=web"
      - "traefik.http.routers.stirling-pdf.rule=Host(`pdf.mvr.io`)"
      - "traefik.http.services.stirling-pdf.loadbalancer.server.port=8080"

  changedetection: 
    image: dgtlmoon/changedetection.io:latest
    container_name: changedetection
    restart: unless-stopped
    volumes:
      - ${DATA_DIR:-/opt/apps}/changedetection:/datastore
    networks:
      - mvr-hl
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.changedetection.entrypoints=web"
      - "traefik.http.routers.changedetection.rule=Host(`changedetection.mvr.io`)"
      - "traefik.http.services.changedetection.loadbalancer.server.port=5000"

  #
  # HomeLab
  #
  nebula-sync:
    image: ghcr.io/lovelaze/nebula-sync:latest
    container_name: nebula-sync
    restart: unless-stopped
    environment:
      - PRIMARY=${NEBULA_SYNC_PRIMARY}
      - REPLICAS=${NEBULA_SYNC_REPLICAS}
      - FULL_SYNC=true
      - RUN_GRAVITY=false
      - CRON=35 * * * *
  
  truenas-auto-update:
    image: ghcr.io/marvinvr/truenas-auto-update:latest
    container_name: truenas-auto-update
    restart: unless-stopped
    environment:
      - BASE_URL=${TRUENAS_BASE_URL}
      - API_KEY=${TRUENAS_API_KEY}
      - APPRISE_URLS=${TRUENAS_APPRISE_URLS}
      - CRON_SCHEDULE=0 4 * * *
      - NOTIFY_ON_SUCCESS=false

  #
  # AI
  #
  open-webui:
    image: ghcr.io/open-webui/open-webui:latest
    container_name: open-webui
    restart: unless-stopped
    networks:
      - mvr-hl
    volumes:
      - ${DATA_DIR:-/opt/apps}/open-webui:/app/backend/data
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.open-webui.entrypoints=web"
      - "traefik.http.routers.open-webui.rule=Host(`chat.mvr.io`)"
      - "traefik.http.services.open-webui.loadbalancer.server.port=8080"
      - "traefik.http.routers.open-webui-chat.entrypoints=web"
      - "traefik.http.routers.open-webui-chat.rule=Host(`chat.mvr.bz`)"
      - "traefik.http.services.open-webui-chat.loadbalancer.server.port=8080"

#  ombi:

networks:
  mvr-hl:
    external: true 